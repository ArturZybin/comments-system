(this["webpackJsonpcomments-system"]=this["webpackJsonpcomments-system"]||[]).push([[0],{38:function(e,t,a){e.exports=a.p+"static/media/avatar.511718fc.svg"},39:function(e,t,a){e.exports=a.p+"static/media/comments.d68b6143.svg"},42:function(e,t,a){e.exports=a.p+"static/media/heart.77100eea.svg"},43:function(e,t,a){e.exports=a(64)},63:function(e,t,a){},64:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(21),c=a(9),s=a(4),m=a(28),u=a(34),l=a.n(u),i=a(35),d=a(19),f={user:null,username:null};var p=a(29),b={comments:[],isCommentsOver:!1};var _=Object(c.b)({authUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_AUTH_USER":return{user:t.payload,username:null};case"SET_AUTH_USER_USERNAME":return Object(d.a)({},e,{username:t.payload});default:return e}},commentsState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_COMMENTS":var a=[].concat(Object(p.a)(e.comments),Object(p.a)(t.payload));return Object(d.a)({},e,{comments:a});case"SET_COMMENTS_OVER":return Object(d.a)({},e,{isCommentsOver:!0});default:return e}}}),v=a(5),h=a(12),E=a(36),g=a(37),O=a(15),j=a.n(O),S=(a(54),a(56),{apiKey:"AIzaSyDpt6WXqe7-GrSdSZxe1w1jD_h9XQIQWYA",authDomain:"comments-system-6e56a.firebaseapp.com",databaseURL:"https://comments-system-6e56a.firebaseio.com",projectId:"comments-system-6e56a",storageBucket:"comments-system-6e56a.appspot.com",messagingSenderId:"463788584226",appId:"1:463788584226:web:d0787997fe53b69d8d497b",measurementId:"G-LMGZ5VEP27"});var N=new function e(){var t=this;Object(g.a)(this,e),this.auth=void 0,this.db=void 0,this.parentURL=void 0,this.doCreateUserWithEmailAndPassword=function(e,a){return t.auth.createUserWithEmailAndPassword(e,a)},this.doSignInWithEmailAndPassword=function(e,a){return t.auth.signInWithEmailAndPassword(e,a)},this.doSignOut=function(){return t.auth.signOut()},this.doPasswordReset=function(e){return t.auth.sendPasswordResetEmail(e)},this.doPasswordUpdate=function(e){var a;return null===(a=t.auth.currentUser)||void 0===a?void 0:a.updatePassword(e)},this.userRef=function(e){return t.db.collection("users").doc(e)},this.commentsRef=function(){return t.db.collection("pages").doc(t.parentURL).collection("comments")},this.doCreateComment=function(e){return t.commentsRef().add(e)},j.a.initializeApp(S),this.auth=j.a.auth(),this.db=j.a.firestore(),this.parentURL=function(){var e,t=window.location.search.substring(1).split("&"),a=Object(E.a)(t);try{for(a.s();!(e=a.n()).done;){var n=e.value.split("=");if("parentURL"===n[0])return n[1]}}catch(r){a.e(r)}finally{a.f()}return"default"}()},w=r.a.createContext(N);var C="/comments",y=a(38),U=a.n(y),R=a(39),x=a.n(R),A=function(){var e=Object(s.c)((function(e){return e.authUser.user})),t=Object(h.g)().pathname===C,a=t?"navbar__button navbar__button_pressed":"navbar__button",n=t?"navbar__button":"navbar__button navbar__button_pressed",o=Object(s.c)((function(e){return e.authUser.username}));return o||(o="Loading..."),r.a.createElement("nav",{className:"navbar"},r.a.createElement(v.b,{to:C,className:a},r.a.createElement("img",{className:"navbar__img",src:x.a,alt:"Comments"})),e?r.a.createElement(v.b,{to:"/account",className:n},o):r.a.createElement(v.b,{to:"/signin",className:n},r.a.createElement("img",{className:"navbar__img",src:U.a,alt:"Sign In"})))},k=a(3),P=function(){var e=Object(n.useContext)(w),t=Object(s.c)((function(e){return e.authUser})),a=t.user,o=t.username,c=Object(n.useState)(""),m=Object(k.a)(c,2),u=m[0],l=m[1];return r.a.createElement("form",{onSubmit:function(t){if(t.preventDefault(),a&&o){var n={authorUsername:o,authorUID:null===a||void 0===a?void 0:a.uid,text:u,created:j.a.firestore.Timestamp.fromMillis(Date.now()),likesCount:0};e.doCreateComment(n).then((function(e){return console.log("Document written with ID: ",e.id)})).then((function(){return l("")})).catch((function(e){return console.error("Error adding document: ",e)}))}}},r.a.createElement("textarea",{value:u,onChange:function(e){return l(e.target.value)},maxLength:1e3,placeholder:"Write a comment..."}),r.a.createElement("button",{type:"submit"},"Write as You"))},D=a(41),I=a.n(D),T=a(42),M=a.n(T),L=function(e){var t=e.comment;return r.a.createElement("div",{className:"comment"},r.a.createElement("div",{className:"comment__author"},t.authorUsername),r.a.createElement("div",{className:"comment__created"},I.a.unix(t.created.seconds).fromNow()),r.a.createElement("p",null,t.text),r.a.createElement("button",{className:"comment__like"},r.a.createElement("img",{src:M.a,alt:"like",width:"20px"}),t.likesCount),r.a.createElement("button",{className:"comment__reply"},"Reply"),r.a.createElement("hr",null))};var W,H=function(){var e=function(){var e=Object(s.b)(),t=Object(s.c)((function(e){return e.commentsState})),a=t.comments,r=t.isCommentsOver,o=Object(n.useContext)(w),c=Object(n.useState)(o.commentsRef().orderBy("created").limit(50)),m=Object(k.a)(c,2),u=m[0],l=m[1],i=Object(n.useState)(!1),d=Object(k.a)(i,2),f=d[0],p=d[1];function b(){f||(p(!0),u.get().then((function(t){if(t.docs.length<50&&e({type:"SET_COMMENTS_OVER"}),t.docs.length){var a=t.docs[t.docs.length-1];l(o.commentsRef().orderBy("created").limit(50).startAfter(a));var n=t.docs.map((function(e){return e.data()}));e(function(e){return{type:"ADD_COMMENTS",payload:e}}(n)),p(!1)}})))}return Object(n.useEffect)((function(){a.length||b()}),[]),{comments:a,loadComments:b,isCommentsOver:r}}(),t=e.comments,a=e.loadComments,o=e.isCommentsOver,c=t.map((function(e){return r.a.createElement(L,{key:e.created.nanoseconds,comment:e})}));return r.a.createElement("div",{className:"comments"},r.a.createElement(P,null),c,r.a.createElement("button",{onClick:a,disabled:o},"Load more comments"))},G=a(11),B=a.n(G),V=function(){var e=Object(h.f)(),t=Object(n.useContext)(w),a=Object(n.useState)(""),o=Object(k.a)(a,2),c=o[0],s=o[1],m=Object(n.useState)(""),u=Object(k.a)(m,2),l=u[0],i=u[1],d=Object(n.useState)(null),f=Object(k.a)(d,2),p=f[0],b=f[1];var _="form__input",E="form__input";_+=c&&!B.a.validate(c)?" form__input_invalid":"",E+=l&&l.length<6?" form__input_invalid":"";var g=l.length<6||!B.a.validate(c);return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title"},"Sign In"),r.a.createElement("form",{onSubmit:function(a){a.preventDefault(),t.doSignInWithEmailAndPassword(c,l).then((function(){s(""),i(""),b(null),e.push(C)})).catch(b)}},r.a.createElement("input",{name:"email",className:_,value:c,onChange:function(e){return s(e.target.value.trim())},type:"text",placeholder:"Email Address"}),r.a.createElement("input",{name:"password",className:E,value:l,onChange:function(e){return i(e.target.value.trim())},type:"password",placeholder:"Password"}),r.a.createElement("button",{disabled:g,type:"submit",className:"form__input form__button"},"Sign In"),p&&r.a.createElement("p",{className:"form__error"},p.message)),r.a.createElement("p",{className:"form__link"},"Don't have an account? ",r.a.createElement(v.b,{to:"/signup"},"Sign up")),r.a.createElement("p",{className:"form__link"},"Forgot password? ",r.a.createElement(v.b,{to:"/password-reset"},"Reset"))))},z=function(){var e=Object(h.f)(),t=Object(n.useContext)(w),a=Object(n.useState)(""),o=Object(k.a)(a,2),c=o[0],s=o[1],m=Object(n.useState)(""),u=Object(k.a)(m,2),l=u[0],i=u[1],d=Object(n.useState)(""),f=Object(k.a)(d,2),p=f[0],b=f[1],_=Object(n.useState)(""),E=Object(k.a)(_,2),g=E[0],O=E[1],j=Object(n.useState)(null),S=Object(k.a)(j,2),N=S[0],y=S[1];var U="form__input",R="form__input",x="form__input",A="form__input";U+=c&&c.length<3&&c.length>15?" form__input_invalid":"",R+=l&&!B.a.validate(l)?" form__input_invalid":"",x+=p&&p.length<6&&p.length>25?" form__input_invalid":"",A+=g&&g!==p?" form__input_invalid":"";var P=p!==g||p.length<6||!B.a.validate(l)||""===c;return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title"},"Sign Up"),r.a.createElement("form",{onSubmit:function(a){a.preventDefault(),t.doCreateUserWithEmailAndPassword(l,p).then((function(e){var a,n=null===(a=e.user)||void 0===a?void 0:a.uid;n&&t.userRef(n).set({username:c,email:l})})).then((function(){s(""),i(""),b(""),O(""),y(null),e.push(C)})).catch(y)}},r.a.createElement("input",{name:"username",className:U,value:c,onChange:function(e){return s(e.target.value.trim())},type:"text",placeholder:"Username"}),r.a.createElement("input",{name:"email",className:R,value:l,onChange:function(e){return i(e.target.value.trim())},type:"text",placeholder:"Email Address"}),r.a.createElement("input",{name:"passwordOne",className:x,value:p,onChange:function(e){return b(e.target.value.trim())},type:"password",placeholder:"Password"}),r.a.createElement("input",{name:"passwordTwo",className:A,value:g,onChange:function(e){return O(e.target.value.trim())},type:"password",placeholder:"Confirm Password"}),r.a.createElement("button",{disabled:P,type:"submit",className:"form__input form__button"},"Sign Up"),N&&r.a.createElement("p",{className:"form__error"},N.message)),r.a.createElement("p",{className:"form__link"},"Already have an account? ",r.a.createElement(v.b,{to:"/signin"},"Sign in"))))},J=function(){var e=Object(h.f)(),t=Object(n.useContext)(w),a=Object(n.useState)(""),o=Object(k.a)(a,2),c=o[0],s=o[1],m=Object(n.useState)(null),u=Object(k.a)(m,2),l=u[0],i=u[1];var d="form__input";d+=c&&!B.a.validate(c)?" form__input_invalid":"";var f=!B.a.validate(c);return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title"},"Reset Password"),r.a.createElement("form",{onSubmit:function(){t.doPasswordReset(c).then((function(){s(""),i(null),e.push("/signin")})).catch(i)}},r.a.createElement("input",{name:"email",className:d,value:c,onChange:function(e){return s(e.target.value.trim())},type:"text",placeholder:"Email Address"}),r.a.createElement("button",{disabled:f,type:"submit",className:"form__input form__button"},"Send reset email"),l&&r.a.createElement("p",{className:"form__error"},l.message)),r.a.createElement("p",{className:"form__link"},"Recall password? ",r.a.createElement(v.b,{to:"/signin"},"Sign in"))))},Q=function(){var e=Object(n.useContext)(w),t=Object(h.f)();return r.a.createElement("button",{onClick:function(){e.doSignOut(),t.push(C)},className:"form__input form__button"},"Sign Out")},X=function(){var e=Object(n.useContext)(w),t=Object(n.useState)(""),a=Object(k.a)(t,2),o=a[0],c=a[1],s=Object(n.useState)(""),m=Object(k.a)(s,2),u=m[0],l=m[1],i=Object(n.useState)(null),d=Object(k.a)(i,2),f=d[0],p=d[1];var b="form__input",_="form__input";b+=o&&o.length<6?" form__input_invalid":"",_+=u&&u!==o?" form__input_invalid":"";var v=o!==u||o.length<6;return r.a.createElement("form",{onSubmit:function(t){var a;t.preventDefault(),null===(a=e.doPasswordUpdate(o))||void 0===a||a.then((function(){c(""),l(""),p(null)})).catch(p)}},r.a.createElement("input",{name:"passwordOne",className:b,value:o,onChange:function(e){return c(e.target.value.trim())},type:"password",placeholder:"New Password"}),r.a.createElement("input",{name:"passwordTwo",className:_,value:u,onChange:function(e){return l(e.target.value.trim())},type:"password",placeholder:"Confirm Password"}),r.a.createElement("button",{disabled:v,type:"submit",className:"form__input form__button"},"Update password"),f&&r.a.createElement("p",{className:"form__error"},f.message))},Y=(W=function(e){return!!e},function(e){return function(t){var a=Object(h.f)(),n=Object(s.c)((function(e){return e.authUser.user})),o=W(n);return o||a.push("/signin"),o?r.a.createElement(e,t):null}})((function(){var e=Object(s.c)((function(e){return e.authUser})),t=e.user,a=e.username;a||(a="Loading ...");var n=null===t||void 0===t?void 0:t.email;return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title form__username"},a),r.a.createElement("h2",{className:"form__title form__email"},n),r.a.createElement(X,null),r.a.createElement("hr",null),r.a.createElement(Q,null)))})),Z=(a(62),a(63),function(){return function(){var e=Object(s.b)(),t=Object(n.useContext)(w);Object(n.useEffect)((function(){return t.auth.onAuthStateChanged((function(a){e({type:"CHANGE_AUTH_USER",payload:a}),a&&t.userRef(null===a||void 0===a?void 0:a.uid).get().then((function(t){var a;if(t.exists){var n=null===(a=t.data())||void 0===a?void 0:a.username;e(function(e){return{type:"SET_AUTH_USER_USERNAME",payload:e}}(n))}}))}))}),[])}(),r.a.createElement(v.a,null,r.a.createElement(A,null),r.a.createElement(h.b,{exact:!0,path:"/"}," ",r.a.createElement(h.a,{to:C})," "),r.a.createElement(h.b,{path:"/comments-system"}," ",r.a.createElement(h.a,{to:C})," "),r.a.createElement(h.b,{path:C,component:H}),r.a.createElement(h.b,{path:"/signin",component:V}),r.a.createElement(h.b,{path:"/signup",component:z}),r.a.createElement(h.b,{path:"/password-reset",component:J}),r.a.createElement(h.b,{path:"/account",component:Y}))}),q={key:"root",blacklist:["commentsState"],storage:l.a},F=Object(m.a)(q,_),K=Object(c.c)(F),$=Object(m.b)(K);Object(o.render)(r.a.createElement(r.a.StrictMode,null,r.a.createElement(s.a,{store:K},r.a.createElement(i.a,{loading:null,persistor:$},r.a.createElement(w.Provider,{value:N},r.a.createElement(Z,null))))),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.95ef34d3.chunk.js.map