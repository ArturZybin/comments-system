(this["webpackJsonpcomments-system"]=this["webpackJsonpcomments-system"]||[]).push([[0],{25:function(e,t,n){e.exports=n.p+"static/media/heart.77100eea.svg"},26:function(e,t,n){e.exports=n.p+"static/media/filled-heart.f2610513.svg"},42:function(e,t,n){e.exports=n.p+"static/media/avatar.511718fc.svg"},43:function(e,t,n){e.exports=n.p+"static/media/comments.d68b6143.svg"},45:function(e,t,n){e.exports=n(66)},65:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(22),s=n(10),c=n(4),i=n(32),u=n(37),m=n.n(u),l=n(38),d=n(39),p=n(5),f={authUser:null,username:null};var b=n(15);function E(e,t){var n;switch(t.type){case"ADD_RESPONSES":return Object(p.a)({},e,{responses:[].concat(Object(b.a)(e.responses),Object(b.a)(t.payload.responses))});case"SET_RESPONSES_OVER":return Object(p.a)({},e,{isResponsesOver:!0});case"CREATE_RESPONSE":return n=[t.payload.response].concat(Object(b.a)(e.responses)),Object(p.a)({},e,{responses:n});case"SET_RESPONS_LIKES":return(n=e.responses)[t.payload.responseIndex].likesCount=t.payload.likesCount,Object(p.a)({},e,{responses:n});case"SET_IS_RESPONS_LIKED":return(n=e.responses)[t.payload.responseIndex].isLiked=t.payload.isLiked,Object(p.a)({},e,{responses:n});default:return e}}var v={comments:[],isCommentsOver:!1};var _=Object(s.combineReducers)({authUserStore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_AUTH_USER":return{authUser:t.payload,username:null};case"SET_AUTH_USER_USERNAME":return Object(p.a)({},e,{username:t.payload});default:return e}},commentsStore:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,a=arguments.length>1?arguments[1]:void 0;switch(a.type){case"ADD_COMMENTS":return e=[].concat(Object(b.a)(n.comments),Object(b.a)(a.payload)),Object(p.a)({},n,{comments:e});case"SET_COMMENTS_OVER":return Object(p.a)({},n,{isCommentsOver:!0});case"CREATE_COMMENT":return e=[a.payload].concat(Object(b.a)(n.comments)),Object(p.a)({},n,{comments:e});case"SET_COMMENT_LIKES":return(e=n.comments)[a.payload.index].likesCount=a.payload.likesCount,Object(p.a)({},n,{comments:e});case"SET_IS_COMMENT_LIKED":return(e=n.comments)[a.payload.index].isLiked=a.payload.isLiked,Object(p.a)({},n,{comments:e});case"ADD_RESPONSES":case"SET_RESPONSES_OVER":case"CREATE_RESPONSE":case"SET_RESPONS_LIKES":case"SET_IS_RESPONS_LIKED":return t=E(t=n.comments[a.payload.commentIndex],a),(e=n.comments)[a.payload.commentIndex]=t,Object(p.a)({},n,{comments:e});default:return n}}}),h=n(6),O=n(14),S=function(e,t){return{type:"SET_COMMENT_LIKES",payload:{index:e,likesCount:t}}},j=function(e,t){return{type:"SET_IS_COMMENT_LIKED",payload:{index:e,isLiked:t}}},g=function(e,t,n){return{type:"SET_RESPONS_LIKES",payload:{commentIndex:e,responseIndex:t,likesCount:n}}},N=function(e,t,n){return{type:"SET_IS_RESPONS_LIKED",payload:{commentIndex:e,responseIndex:t,isLiked:n}}},R=n(40),y=n(41),C=n(13),x=n.n(C),k=(n(56),n(58),{apiKey:"AIzaSyDpt6WXqe7-GrSdSZxe1w1jD_h9XQIQWYA",authDomain:"comments-system-6e56a.firebaseapp.com",databaseURL:"https://comments-system-6e56a.firebaseio.com",projectId:"comments-system-6e56a",storageBucket:"comments-system-6e56a.appspot.com",messagingSenderId:"463788584226",appId:"1:463788584226:web:d0787997fe53b69d8d497b",measurementId:"G-LMGZ5VEP27"});var w=new function e(){var t=this;Object(y.a)(this,e),this.auth=void 0,this.db=void 0,this.parentURL=void 0,this.doCreateUserWithEmailAndPassword=function(e,n){return t.auth.createUserWithEmailAndPassword(e,n)},this.doSignInWithEmailAndPassword=function(e,n){return t.auth.signInWithEmailAndPassword(e,n)},this.doSignOut=function(){return t.auth.signOut()},this.doPasswordReset=function(e){return t.auth.sendPasswordResetEmail(e)},this.doPasswordUpdate=function(e){var n;return null===(n=t.auth.currentUser)||void 0===n?void 0:n.updatePassword(e)},this.userRef=function(e){return t.db.collection("users").doc(e)},this.doCreateComment=function(e){return t.commentsRef().add(e)},this.commentsRef=function(){return t.db.collection("pages").doc(t.parentURL).collection("comments")},this.commentLikesRef=function(e){return e.collection("likes")},this.doCreateResponse=function(e,n){return t.responsesRef(e).add(n)},this.responsesRef=function(e){return e.collection("responses")},this.responseLikesRef=function(e){return e.collection("likes")},x.a.initializeApp(k),this.auth=x.a.auth(),this.db=x.a.firestore(),this.parentURL=function(){var e,t=window.location.search.substring(1).split("&"),n=Object(R.a)(t);try{for(n.s();!(e=n.n()).done;){var a=e.value.split("=");if("parentURL"===a[0])return a[1]}}catch(r){n.e(r)}finally{n.f()}return"default"}()},I=r.a.createContext(w);var U="/signin",L=n(42),T=n.n(L),P=n(43),A=n.n(P),D=function(){var e=Object(c.c)((function(e){return e.authUserStore})),t=e.authUser,n=e.username;n||(n="Loading...");var a="/comments"===Object(O.g)().pathname,o=a?"navbar__button navbar__button_pressed":"navbar__button",s=a?"navbar__button":"navbar__button navbar__button_pressed";return r.a.createElement("nav",{className:"navbar"},r.a.createElement(h.b,{to:"/comments",className:o},r.a.createElement("img",{className:"navbar__img",src:A.a,alt:"Comments"})),t?r.a.createElement(h.b,{to:"/account",className:s},n):r.a.createElement(h.b,{to:U,className:s},r.a.createElement("img",{className:"navbar__img",src:T.a,alt:"Sign In"})))},M=n(2),W=function(){var e=Object(O.f)(),t=Object(c.b)(),n=Object(a.useContext)(I),o=Object(c.c)((function(e){return e.authUserStore})),s=o.authUser,i=o.username,u=Object(a.useState)(""),m=Object(M.a)(u,2),l=m[0],d=m[1];return r.a.createElement("form",{onSubmit:function(a){if(a.preventDefault(),i&&s){var r={authorUsername:i,authorUID:null===s||void 0===s?void 0:s.uid,text:l,created:x.a.firestore.Timestamp.fromMillis(Date.now())};n.doCreateComment(r).then((function(e){return t(function(e){return{type:"CREATE_COMMENT",payload:e}}(Object(p.a)({},r,{docRef:e,responses:[],isResponsesOver:!1})))})).then((function(){return d("")})).catch((function(e){return console.error("Error adding comment: ",e)}))}else s||e.push(U)}},r.a.createElement("textarea",{value:l,onChange:function(e){return d(e.target.value)},maxLength:1e3,placeholder:"Write a comment..."}),s?r.a.createElement("button",{type:"submit"},"Write as ",i||"you"):r.a.createElement("span",null,r.a.createElement(h.b,{to:U},"Sign in")," to publish"))},K=n(24),B=n.n(K),H=function(e){var t=e.commentRef,n=e.commentIndex,o=Object(O.f)(),s=Object(c.b)(),i=Object(a.useContext)(I),u=Object(c.c)((function(e){return e.authUserStore})),m=u.authUser,l=u.username,d=Object(a.useState)(""),f=Object(M.a)(d,2),b=f[0],E=f[1];return r.a.createElement("form",{onSubmit:function(e){if(e.preventDefault(),l&&m){var a={authorUsername:l,authorUID:null===m||void 0===m?void 0:m.uid,text:b,created:x.a.firestore.Timestamp.fromMillis(Date.now())};i.doCreateResponse(t,a).then((function(e){return s(function(e,t){return{type:"CREATE_RESPONSE",payload:{commentIndex:e,response:t}}}(n,Object(p.a)({},a,{docRef:e})))})).then((function(){return E("")})).catch((function(e){return console.error("Error adding response: ",e)}))}else m||o.push(U)}},r.a.createElement("textarea",{value:b,onChange:function(e){return E(e.target.value)},maxLength:1e3,placeholder:"Write a response..."}),m?r.a.createElement("button",{type:"submit"},"Write as ",l||"you"):r.a.createElement("span",null,r.a.createElement(h.b,{to:U},"Sign in")," to publish"))},V=n(25),G=n.n(V),F=n(26),z=n.n(F),J=function(e){var t=e.response,n=e.responseIndex,o=e.commentIndex,s=Object(O.f)(),i=Object(c.b)(),u=Object(a.useContext)(I),m=Object(c.c)((function(e){return e.authUserStore.authUser}));Object(a.useEffect)((function(){!function(){var e=t.docRef;u.responseLikesRef(e).get().then((function(e){var t=e.docs.length,a=0!==e.docs.filter((function(e){return e.data().uid===(null===m||void 0===m?void 0:m.uid)})).length;i(g(o,n,t)),i(N(o,n,a))}))}()}),[m]);var l=t.isLiked?z.a:G.a;return r.a.createElement("div",{className:"response"},r.a.createElement("div",{className:"response__author"},t.authorUsername),r.a.createElement("div",{className:"response__created"},B.a.unix(t.created.seconds).fromNow()),r.a.createElement("p",null,t.text),r.a.createElement("button",{className:"response__like",onClick:function(){if(m){if(void 0!==t.likesCount&&void 0!==t.isLiked){var e=u.responseLikesRef(t.docRef).doc(m.uid);t.isLiked?(i(g(o,n,t.likesCount-1)),e.delete()):(i(g(o,n,t.likesCount+1)),e.set({uid:m.uid})),i(N(o,n,!t.isLiked))}}else s.push(U)}},r.a.createElement("img",{src:l,alt:"like",width:"20px"}),t.likesCount))};var Q=function(e){var t=e.comment,n=e.commentIndex,o=e.showForm,s=function(e,t){var n=Object(c.b)(),r=e.responses,o=e.isResponsesOver,s=Object(a.useContext)(I).responsesRef(e.docRef),i=Object(a.useState)(s.orderBy("created","desc").limit(10)),u=Object(M.a)(i,2),m=u[0],l=u[1],d=Object(a.useState)(!1),f=Object(M.a)(d,2),b=f[0],E=f[1];function v(){b||(E(!0),m.get().then((function(e){if(e.docs.length<10&&n(function(e){return{type:"SET_RESPONSES_OVER",payload:{commentIndex:e}}}(t)),e.docs.length){var a=e.docs[e.docs.length-1];l(s.orderBy("created","desc").limit(10).startAfter(a));var r=e.docs.map((function(e){return Object(p.a)({},e.data(),{docRef:e.ref})}));n(function(e,t){return{type:"ADD_RESPONSES",payload:{commentIndex:e,responses:t}}}(t,r)),E(!1)}})))}return Object(a.useEffect)((function(){(null===r||void 0===r?void 0:r.length)||v()}),[]),{responses:r,loadResponses:v,isResponsesOver:o}}(t,n),i=s.responses,u=s.loadResponses,m=s.isResponsesOver,l=null===i||void 0===i?void 0:i.map((function(e,t){return r.a.createElement(J,{key:e.created.nanoseconds,responseIndex:t,commentIndex:n,response:e})})),d=!m;return r.a.createElement("div",{className:"responses"},o&&r.a.createElement(H,{commentRef:t.docRef,commentIndex:n}),l,d&&r.a.createElement("button",{onClick:u},"Load more responses"))},X=function(e){var t=e.comment,n=e.commentIndex,o=Object(O.f)(),s=Object(c.b)(),i=Object(a.useContext)(I),u=Object(c.c)((function(e){return e.authUserStore.authUser})),m=Object(a.useState)(!1),l=Object(M.a)(m,2),d=l[0],p=l[1];Object(a.useEffect)((function(){!function(){var e=t.docRef;i.commentLikesRef(e).get().then((function(e){var t=e.docs.length,a=0!==e.docs.filter((function(e){return e.data().uid===(null===u||void 0===u?void 0:u.uid)})).length;s(S(n,t)),s(j(n,a))}))}()}),[u]);var f=t.isLiked?z.a:G.a;return r.a.createElement("div",{className:"comment"},r.a.createElement("div",{className:"comment__author"},t.authorUsername),r.a.createElement("div",{className:"comment__created"},B.a.unix(t.created.seconds).fromNow()),r.a.createElement("p",null,t.text),r.a.createElement("button",{className:"comment__like",onClick:function(){if(u){if(void 0!==t.likesCount&&void 0!==t.isLiked){var e=i.commentLikesRef(t.docRef).doc(null===u||void 0===u?void 0:u.uid);t.isLiked?(s(S(n,t.likesCount-1)),e.delete()):(s(S(n,t.likesCount+1)),e.set({uid:null===u||void 0===u?void 0:u.uid})),s(j(n,!t.isLiked))}}else o.push(U)}},r.a.createElement("img",{src:f,alt:"like",width:"20px"}),t.likesCount),r.a.createElement("button",{className:"comment__reply",onClick:function(){u?p(!d):o.push(U)}},"Reply"),r.a.createElement(Q,{comment:t,commentIndex:n,showForm:d}),r.a.createElement("hr",null))};var Z,q=function(){var e=function(){var e=Object(c.b)(),t=Object(c.c)((function(e){return e.commentsStore})),n=t.comments,r=t.isCommentsOver,o=Object(a.useContext)(I),s=Object(a.useState)(o.commentsRef().orderBy("created","desc").limit(50)),i=Object(M.a)(s,2),u=i[0],m=i[1],l=Object(a.useState)(!1),d=Object(M.a)(l,2),f=d[0],b=d[1];function E(){f||(b(!0),u.get().then((function(t){if(t.docs.length<50&&e({type:"SET_COMMENTS_OVER"}),t.docs.length){var n=t.docs[t.docs.length-1];m(o.commentsRef().orderBy("created","desc").limit(50).startAfter(n));var a=t.docs.map((function(e){return Object(p.a)({},e.data(),{docRef:e.ref,responses:[],isResponsesOver:!1})}));e(function(e){return{type:"ADD_COMMENTS",payload:e}}(a)),b(!1)}})))}return Object(a.useEffect)((function(){n.length||E()}),[]),{comments:n,loadComments:E,isCommentsOver:r}}(),t=e.comments,n=e.loadComments,o=e.isCommentsOver,s=t.map((function(e,t){return r.a.createElement(X,{key:e.created.nanoseconds,commentIndex:t,comment:e})})),i=!o;return!o&&!t.length?r.a.createElement("p",null,"Loading..."):r.a.createElement("div",{className:"comments"},r.a.createElement(W,null),s,i&&r.a.createElement("button",{onClick:n},"Load more comments"))},Y=n(12),$=n.n(Y),ee=function(){var e=Object(O.f)(),t=Object(a.useContext)(I),n=Object(a.useState)(""),o=Object(M.a)(n,2),s=o[0],c=o[1],i=Object(a.useState)(""),u=Object(M.a)(i,2),m=u[0],l=u[1],d=Object(a.useState)(null),p=Object(M.a)(d,2),f=p[0],b=p[1];var E="form__input",v="form__input";E+=s&&!$.a.validate(s)?" form__input_invalid":"",v+=m&&m.length<6?" form__input_invalid":"";var _=m.length<6||!$.a.validate(s);return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title"},"Sign In"),r.a.createElement("form",{onSubmit:function(n){n.preventDefault(),t.doSignInWithEmailAndPassword(s,m).then((function(){c(""),l(""),b(null),e.push("/comments")})).catch(b)}},r.a.createElement("input",{name:"email",className:E,value:s,onChange:function(e){return c(e.target.value.trim())},type:"text",placeholder:"Email Address"}),r.a.createElement("input",{name:"password",className:v,value:m,onChange:function(e){return l(e.target.value.trim())},type:"password",placeholder:"Password"}),r.a.createElement("button",{disabled:_,type:"submit",className:"form__input form__button"},"Sign In"),f&&r.a.createElement("p",{className:"form__error"},f.message)),r.a.createElement("p",{className:"form__link"},"Don't have an account? ",r.a.createElement(h.b,{to:"/signup"},"Sign up")),r.a.createElement("p",{className:"form__link"},"Forgot password? ",r.a.createElement(h.b,{to:"/password-reset"},"Reset"))))},te=function(){var e=Object(O.f)(),t=Object(a.useContext)(I),n=Object(a.useState)(""),o=Object(M.a)(n,2),s=o[0],c=o[1],i=Object(a.useState)(""),u=Object(M.a)(i,2),m=u[0],l=u[1],d=Object(a.useState)(""),p=Object(M.a)(d,2),f=p[0],b=p[1],E=Object(a.useState)(""),v=Object(M.a)(E,2),_=v[0],S=v[1],j=Object(a.useState)(null),g=Object(M.a)(j,2),N=g[0],R=g[1];var y="form__input",C="form__input",x="form__input",k="form__input";y+=s&&s.length<3&&s.length>15?" form__input_invalid":"",C+=m&&!$.a.validate(m)?" form__input_invalid":"",x+=f&&f.length<6&&f.length>25?" form__input_invalid":"",k+=_&&_!==f?" form__input_invalid":"";var w=f!==_||f.length<6||!$.a.validate(m)||""===s;return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title"},"Sign Up"),r.a.createElement("form",{onSubmit:function(n){n.preventDefault(),t.doCreateUserWithEmailAndPassword(m,f).then((function(e){var n,a=null===(n=e.user)||void 0===n?void 0:n.uid;a&&t.userRef(a).set({username:s,email:m})})).then((function(){c(""),l(""),b(""),S(""),R(null),e.push("/comments")})).catch(R)}},r.a.createElement("input",{name:"username",className:y,value:s,onChange:function(e){return c(e.target.value.trim())},type:"text",placeholder:"Username"}),r.a.createElement("input",{name:"email",className:C,value:m,onChange:function(e){return l(e.target.value.trim())},type:"text",placeholder:"Email Address"}),r.a.createElement("input",{name:"passwordOne",className:x,value:f,onChange:function(e){return b(e.target.value.trim())},type:"password",placeholder:"Password"}),r.a.createElement("input",{name:"passwordTwo",className:k,value:_,onChange:function(e){return S(e.target.value.trim())},type:"password",placeholder:"Confirm Password"}),r.a.createElement("button",{disabled:w,type:"submit",className:"form__input form__button"},"Sign Up"),N&&r.a.createElement("p",{className:"form__error"},N.message)),r.a.createElement("p",{className:"form__link"},"Already have an account? ",r.a.createElement(h.b,{to:U},"Sign in"))))},ne=function(){var e=Object(O.f)(),t=Object(a.useContext)(I),n=Object(a.useState)(""),o=Object(M.a)(n,2),s=o[0],c=o[1],i=Object(a.useState)(null),u=Object(M.a)(i,2),m=u[0],l=u[1];var d="form__input";d+=s&&!$.a.validate(s)?" form__input_invalid":"";var p=!$.a.validate(s);return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title"},"Reset Password"),r.a.createElement("form",{onSubmit:function(){t.doPasswordReset(s).then((function(){c(""),l(null),e.push(U)})).catch(l)}},r.a.createElement("input",{name:"email",className:d,value:s,onChange:function(e){return c(e.target.value.trim())},type:"text",placeholder:"Email Address"}),r.a.createElement("button",{disabled:p,type:"submit",className:"form__input form__button"},"Send reset email"),m&&r.a.createElement("p",{className:"form__error"},m.message)),r.a.createElement("p",{className:"form__link"},"Recall password? ",r.a.createElement(h.b,{to:U},"Sign in"))))},ae=function(){var e=Object(a.useContext)(I),t=Object(O.f)();return r.a.createElement("button",{onClick:function(){e.doSignOut(),t.push("/comments")},className:"form__input form__button"},"Sign Out")},re=function(){var e=Object(a.useContext)(I),t=Object(a.useState)(""),n=Object(M.a)(t,2),o=n[0],s=n[1],c=Object(a.useState)(""),i=Object(M.a)(c,2),u=i[0],m=i[1],l=Object(a.useState)(null),d=Object(M.a)(l,2),p=d[0],f=d[1];var b="form__input",E="form__input";b+=o&&o.length<6?" form__input_invalid":"",E+=u&&u!==o?" form__input_invalid":"";var v=o!==u||o.length<6;return r.a.createElement("form",{onSubmit:function(t){var n;t.preventDefault(),null===(n=e.doPasswordUpdate(o))||void 0===n||n.then((function(){s(""),m(""),f(null)})).catch(f)}},r.a.createElement("input",{name:"passwordOne",className:b,value:o,onChange:function(e){return s(e.target.value.trim())},type:"password",placeholder:"New Password"}),r.a.createElement("input",{name:"passwordTwo",className:E,value:u,onChange:function(e){return m(e.target.value.trim())},type:"password",placeholder:"Confirm Password"}),r.a.createElement("button",{disabled:v,type:"submit",className:"form__input form__button"},"Update password"),p&&r.a.createElement("p",{className:"form__error"},p.message))},oe=(Z=function(e){return!!e},function(e){return function(t){var n=Object(O.f)(),a=Object(c.c)((function(e){return e.authUserStore.authUser})),o=Z(a);return o||n.push(U),o?r.a.createElement(e,t):null}})((function(){var e=Object(c.c)((function(e){return e.authUserStore})),t=e.authUser,n=e.username;n||(n="Loading ...");var a=null===t||void 0===t?void 0:t.email;return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title form__username"},n),r.a.createElement("h2",{className:"form__title form__email"},a),r.a.createElement(re,null),r.a.createElement("hr",null),r.a.createElement(ae,null)))})),se=(n(64),n(65),function(){return function(){var e=Object(c.b)(),t=Object(a.useContext)(I);Object(a.useEffect)((function(){return t.auth.onAuthStateChanged((function(n){e({type:"CHANGE_AUTH_USER",payload:n}),n&&t.userRef(null===n||void 0===n?void 0:n.uid).get().then((function(t){var n;if(t.exists){var a=null===(n=t.data())||void 0===n?void 0:n.username;e(function(e){return{type:"SET_AUTH_USER_USERNAME",payload:e}}(a))}}))}))}),[])}(),r.a.createElement(h.a,{basename:"/comments-system"},r.a.createElement(D,null),r.a.createElement(O.b,{exact:!0,path:"/"}," ",r.a.createElement(O.a,{to:"/comments"})," "),r.a.createElement(O.b,{path:"/comments",component:q}),r.a.createElement(O.b,{path:U,component:ee}),r.a.createElement(O.b,{path:"/signup",component:te}),r.a.createElement(O.b,{path:"/password-reset",component:ne}),r.a.createElement(O.b,{path:"/account",component:oe}))}),ce={key:"root",blacklist:["commentsStore"],storage:m.a},ie=Object(i.a)(ce,_),ue=Object(s.createStore)(ie,Object(d.composeWithDevTools)()),me=Object(i.b)(ue);Object(o.render)(r.a.createElement(r.a.StrictMode,null,r.a.createElement(c.a,{store:ue},r.a.createElement(l.a,{loading:null,persistor:me},r.a.createElement(I.Provider,{value:w},r.a.createElement(se,null))))),document.getElementById("root"))}},[[45,1,2]]]);
//# sourceMappingURL=main.5736c5ac.chunk.js.map