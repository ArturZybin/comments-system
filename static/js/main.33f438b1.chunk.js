(this["webpackJsonpcomments-system"]=this["webpackJsonpcomments-system"]||[]).push([[0],{37:function(e,t,a){e.exports=a.p+"static/media/avatar.511718fc.svg"},38:function(e,t,a){e.exports=a.p+"static/media/comments.d68b6143.svg"},41:function(e,t,a){e.exports=a.p+"static/media/heart.77100eea.svg"},43:function(e,t,a){e.exports=a(64)},63:function(e,t,a){},64:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(20),o=a(9),s=a(4),m=a(27),u=a(33),l=a.n(u),i=a(34),d=a(42),f={user:null,username:null};var p=a(28);var b=Object(o.b)({authUser:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_AUTH_USER":return{user:t.payload,username:null};case"SET_AUTH_USER_USERNAME":return Object(d.a)({},e,{username:t.payload});default:return e}},comments:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_COMMENTS":return[].concat(Object(p.a)(e),Object(p.a)(t.payload));default:return e}}}),_=a(5),v=a(12),h=a(35),E=a(36),g=a(15),O=a.n(g),j=(a(54),a(56),{apiKey:"AIzaSyDpt6WXqe7-GrSdSZxe1w1jD_h9XQIQWYA",authDomain:"comments-system-6e56a.firebaseapp.com",databaseURL:"https://comments-system-6e56a.firebaseio.com",projectId:"comments-system-6e56a",storageBucket:"comments-system-6e56a.appspot.com",messagingSenderId:"463788584226",appId:"1:463788584226:web:d0787997fe53b69d8d497b",measurementId:"G-LMGZ5VEP27"});var N=new function e(){var t=this;Object(E.a)(this,e),this.auth=void 0,this.db=void 0,this.parentURL=void 0,this.doCreateUserWithEmailAndPassword=function(e,a){return t.auth.createUserWithEmailAndPassword(e,a)},this.doSignInWithEmailAndPassword=function(e,a){return t.auth.signInWithEmailAndPassword(e,a)},this.doSignOut=function(){return t.auth.signOut()},this.doPasswordReset=function(e){return t.auth.sendPasswordResetEmail(e)},this.doPasswordUpdate=function(e){var a;return null===(a=t.auth.currentUser)||void 0===a?void 0:a.updatePassword(e)},this.userRef=function(e){return t.db.collection("users").doc(e)},this.commentsRef=function(){return t.db.collection("pages").doc(t.parentURL).collection("comments")},this.doCreateComment=function(e){return t.commentsRef().add(e)},O.a.initializeApp(j),this.auth=O.a.auth(),this.db=O.a.firestore(),this.parentURL=function(){var e,t=window.location.search.substring(1).split("&"),a=Object(h.a)(t);try{for(a.s();!(e=a.n()).done;){var n=e.value.split("=");if("parentURL"===n[0])return n[1]}}catch(r){a.e(r)}finally{a.f()}return"default"}()},S=r.a.createContext(N);var w="/comments",y=a(37),C=a.n(y),U=a(38),x=a.n(U),A=function(){var e=Object(s.c)((function(e){return e.authUser.user})),t=Object(v.g)().pathname===w,a=t?"navbar__button navbar__button_pressed":"navbar__button",n=t?"navbar__button":"navbar__button navbar__button_pressed",c=Object(s.c)((function(e){return e.authUser.username}));return c||(c="Loading..."),r.a.createElement("nav",{className:"navbar"},r.a.createElement(_.b,{to:w,className:a},r.a.createElement("img",{className:"navbar__img",src:x.a,alt:"Comments"})),e?r.a.createElement(_.b,{to:"/account",className:n},c):r.a.createElement(_.b,{to:"/signin",className:n},r.a.createElement("img",{className:"navbar__img",src:C.a,alt:"Sign In"})))},R=a(3),k=function(){var e=Object(n.useContext)(S),t=Object(s.c)((function(e){return e.authUser})),a=t.user,c=t.username,o=Object(n.useState)(""),m=Object(R.a)(o,2),u=m[0],l=m[1];return r.a.createElement("form",{onSubmit:function(t){if(t.preventDefault(),a&&c){var n={authorUsername:c,authorUID:null===a||void 0===a?void 0:a.uid,text:u,created:O.a.firestore.Timestamp.fromMillis(Date.now()),likesCount:0};e.doCreateComment(n).then((function(e){return console.log("Document written with ID: ",e.id)})).then((function(){return l("")})).catch((function(e){return console.error("Error adding document: ",e)}))}}},r.a.createElement("textarea",{value:u,onChange:function(e){return l(e.target.value)},maxLength:1e3,placeholder:"Write a comment..."}),r.a.createElement("button",{type:"submit"},"Write as You"))},P=a(40),D=a.n(P),I=a(41),T=a.n(I),L=function(e){var t=e.comment;return r.a.createElement("div",{className:"comment"},r.a.createElement("div",{className:"comment__author"},t.authorUsername),r.a.createElement("div",{className:"comment__created"},D.a.unix(t.created.seconds).fromNow()),r.a.createElement("p",null,t.text),r.a.createElement("button",{className:"comment__like"},r.a.createElement("img",{src:T.a,alt:"like",width:"20px"}),t.likesCount),r.a.createElement("button",{className:"comment__reply"},"Reply"),r.a.createElement("hr",null))};var W,M=function(){var e=function(){var e=Object(s.b)(),t=Object(s.c)((function(e){return e.comments})),a=Object(n.useContext)(S),r=Object(n.useState)(a.commentsRef().orderBy("created").limit(50)),c=Object(R.a)(r,2),o=c[0],m=c[1],u=Object(n.useState)(!1),l=Object(R.a)(u,2),i=l[0],d=l[1],f=Object(n.useState)(!1),p=Object(R.a)(f,2),b=p[0],_=p[1];function v(){i||(d(!0),o.get().then((function(t){if(t.docs.length<50&&_(!0),t.docs.length){var n=t.docs[t.docs.length-1];m(a.commentsRef().orderBy("created").limit(50).startAfter(n));var r=t.docs.map((function(e){return e.data()}));e(function(e){return{type:"ADD_COMMENTS",payload:e}}(r)),d(!1)}})))}return Object(n.useEffect)((function(){v()}),[]),{comments:t,loadComments:v,isCommentsOver:b}}(),t=e.comments,a=e.loadComments,c=e.isCommentsOver,o=t.map((function(e){return r.a.createElement(L,{key:e.created.nanoseconds,comment:e})}));return r.a.createElement("div",{className:"comments"},r.a.createElement(k,null),o,r.a.createElement("button",{onClick:a,disabled:c},"Load more comments"))},H=a(11),G=a.n(H),B=function(){var e=Object(v.f)(),t=Object(n.useContext)(S),a=Object(n.useState)(""),c=Object(R.a)(a,2),o=c[0],s=c[1],m=Object(n.useState)(""),u=Object(R.a)(m,2),l=u[0],i=u[1],d=Object(n.useState)(null),f=Object(R.a)(d,2),p=f[0],b=f[1];var h="form__input",E="form__input";h+=o&&!G.a.validate(o)?" form__input_invalid":"",E+=l&&l.length<6?" form__input_invalid":"";var g=l.length<6||!G.a.validate(o);return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title"},"Sign In"),r.a.createElement("form",{onSubmit:function(a){a.preventDefault(),t.doSignInWithEmailAndPassword(o,l).then((function(){s(""),i(""),b(null),e.push(w)})).catch(b)}},r.a.createElement("input",{name:"email",className:h,value:o,onChange:function(e){return s(e.target.value.trim())},type:"text",placeholder:"Email Address"}),r.a.createElement("input",{name:"password",className:E,value:l,onChange:function(e){return i(e.target.value.trim())},type:"password",placeholder:"Password"}),r.a.createElement("button",{disabled:g,type:"submit",className:"form__input form__button"},"Sign In"),p&&r.a.createElement("p",{className:"form__error"},p.message)),r.a.createElement("p",{className:"form__link"},"Don't have an account? ",r.a.createElement(_.b,{to:"/signup"},"Sign up")),r.a.createElement("p",{className:"form__link"},"Forgot password? ",r.a.createElement(_.b,{to:"/password-reset"},"Reset"))))},z=function(){var e=Object(v.f)(),t=Object(n.useContext)(S),a=Object(n.useState)(""),c=Object(R.a)(a,2),o=c[0],s=c[1],m=Object(n.useState)(""),u=Object(R.a)(m,2),l=u[0],i=u[1],d=Object(n.useState)(""),f=Object(R.a)(d,2),p=f[0],b=f[1],h=Object(n.useState)(""),E=Object(R.a)(h,2),g=E[0],O=E[1],j=Object(n.useState)(null),N=Object(R.a)(j,2),y=N[0],C=N[1];var U="form__input",x="form__input",A="form__input",k="form__input";U+=o&&o.length<3&&o.length>15?" form__input_invalid":"",x+=l&&!G.a.validate(l)?" form__input_invalid":"",A+=p&&p.length<6&&p.length>25?" form__input_invalid":"",k+=g&&g!==p?" form__input_invalid":"";var P=p!==g||p.length<6||!G.a.validate(l)||""===o;return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title"},"Sign Up"),r.a.createElement("form",{onSubmit:function(a){a.preventDefault(),t.doCreateUserWithEmailAndPassword(l,p).then((function(e){var a,n=null===(a=e.user)||void 0===a?void 0:a.uid;n&&t.userRef(n).set({username:o,email:l})})).then((function(){s(""),i(""),b(""),O(""),C(null),e.push(w)})).catch(C)}},r.a.createElement("input",{name:"username",className:U,value:o,onChange:function(e){return s(e.target.value.trim())},type:"text",placeholder:"Username"}),r.a.createElement("input",{name:"email",className:x,value:l,onChange:function(e){return i(e.target.value.trim())},type:"text",placeholder:"Email Address"}),r.a.createElement("input",{name:"passwordOne",className:A,value:p,onChange:function(e){return b(e.target.value.trim())},type:"password",placeholder:"Password"}),r.a.createElement("input",{name:"passwordTwo",className:k,value:g,onChange:function(e){return O(e.target.value.trim())},type:"password",placeholder:"Confirm Password"}),r.a.createElement("button",{disabled:P,type:"submit",className:"form__input form__button"},"Sign Up"),y&&r.a.createElement("p",{className:"form__error"},y.message)),r.a.createElement("p",{className:"form__link"},"Already have an account? ",r.a.createElement(_.b,{to:"/signin"},"Sign in"))))},J=function(){var e=Object(v.f)(),t=Object(n.useContext)(S),a=Object(n.useState)(""),c=Object(R.a)(a,2),o=c[0],s=c[1],m=Object(n.useState)(null),u=Object(R.a)(m,2),l=u[0],i=u[1];var d="form__input";d+=o&&!G.a.validate(o)?" form__input_invalid":"";var f=!G.a.validate(o);return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title"},"Reset Password"),r.a.createElement("form",{onSubmit:function(){t.doPasswordReset(o).then((function(){s(""),i(null),e.push("/signin")})).catch(i)}},r.a.createElement("input",{name:"email",className:d,value:o,onChange:function(e){return s(e.target.value.trim())},type:"text",placeholder:"Email Address"}),r.a.createElement("button",{disabled:f,type:"submit",className:"form__input form__button"},"Send reset email"),l&&r.a.createElement("p",{className:"form__error"},l.message)),r.a.createElement("p",{className:"form__link"},"Recall password? ",r.a.createElement(_.b,{to:"/signin"},"Sign in"))))},Q=function(){var e=Object(n.useContext)(S),t=Object(v.f)();return r.a.createElement("button",{onClick:function(){e.doSignOut(),t.push(w)},className:"form__input form__button"},"Sign Out")},X=function(){var e=Object(n.useContext)(S),t=Object(n.useState)(""),a=Object(R.a)(t,2),c=a[0],o=a[1],s=Object(n.useState)(""),m=Object(R.a)(s,2),u=m[0],l=m[1],i=Object(n.useState)(null),d=Object(R.a)(i,2),f=d[0],p=d[1];var b="form__input",_="form__input";b+=c&&c.length<6?" form__input_invalid":"",_+=u&&u!==c?" form__input_invalid":"";var v=c!==u||c.length<6;return r.a.createElement("form",{onSubmit:function(t){var a;t.preventDefault(),null===(a=e.doPasswordUpdate(c))||void 0===a||a.then((function(){o(""),l(""),p(null)})).catch(p)}},r.a.createElement("input",{name:"passwordOne",className:b,value:c,onChange:function(e){return o(e.target.value.trim())},type:"password",placeholder:"New Password"}),r.a.createElement("input",{name:"passwordTwo",className:_,value:u,onChange:function(e){return l(e.target.value.trim())},type:"password",placeholder:"Confirm Password"}),r.a.createElement("button",{disabled:v,type:"submit",className:"form__input form__button"},"Update password"),f&&r.a.createElement("p",{className:"form__error"},f.message))},Y=(W=function(e){return!!e},function(e){return function(t){var a=Object(v.f)(),n=Object(s.c)((function(e){return e.authUser.user})),c=W(n);return c||a.push("/signin"),c?r.a.createElement(e,t):null}})((function(){var e=Object(s.c)((function(e){return e.authUser})),t=e.user,a=e.username;a||(a="Loading ...");var n=null===t||void 0===t?void 0:t.email;return r.a.createElement("div",{className:"form-background"},r.a.createElement("div",{className:"form"},r.a.createElement("h2",{className:"form__title form__username"},a),r.a.createElement("h2",{className:"form__title form__email"},n),r.a.createElement(X,null),r.a.createElement("hr",null),r.a.createElement(Q,null)))})),Z=(a(62),a(63),function(){return function(){var e=Object(s.b)(),t=Object(n.useContext)(S);Object(n.useEffect)((function(){return t.auth.onAuthStateChanged((function(a){e({type:"CHANGE_AUTH_USER",payload:a}),a&&t.userRef(null===a||void 0===a?void 0:a.uid).get().then((function(t){var a;if(t.exists){var n=null===(a=t.data())||void 0===a?void 0:a.username;e(function(e){return{type:"SET_AUTH_USER_USERNAME",payload:e}}(n))}}))}))}),[])}(),r.a.createElement(_.a,null,r.a.createElement(A,null),r.a.createElement(v.b,{exact:!0,path:"/"}," ",r.a.createElement(v.a,{to:w})," "),r.a.createElement(v.b,{path:"/comments-system"}," ",r.a.createElement(v.a,{to:w})," "),r.a.createElement(v.b,{path:w,component:M}),r.a.createElement(v.b,{path:"/signin",component:B}),r.a.createElement(v.b,{path:"/signup",component:z}),r.a.createElement(v.b,{path:"/password-reset",component:J}),r.a.createElement(v.b,{path:"/account",component:Y}))}),q={key:"root",blacklist:["comments"],storage:l.a},F=Object(m.a)(q,b),K=Object(o.c)(F),V=Object(m.b)(K);Object(c.render)(r.a.createElement(r.a.StrictMode,null,r.a.createElement(s.a,{store:K},r.a.createElement(i.a,{loading:null,persistor:V},r.a.createElement(S.Provider,{value:N},r.a.createElement(Z,null))))),document.getElementById("root"))}},[[43,1,2]]]);
//# sourceMappingURL=main.33f438b1.chunk.js.map